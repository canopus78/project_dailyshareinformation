name: Daily Stock Analysis

on:
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 9ì‹œ
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  stock-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        pip install pandas numpy matplotlib seaborn requests yfinance smtplib-ssl

    - name: Update stock data and run analysis
      env:
        GMAIL_USERNAME: ${{ secrets.GMAIL_USERNAME }}
        GMAIL_PASSWORD: ${{ secrets.GMAIL_PASSWORD }}
        RECIPIENT_EMAIL: ${{ secrets.RECIPIENT_EMAIL }}
      run: |
        python -c "
        import sys
        import json
        import smtplib
        from email.mime.text import MimeText
        from email.mime.multipart import MimeMultipart
        import os
        from datetime import datetime
        
        # ê°„ë‹¨í•œ ì£¼ì‹ ë¶„ì„ ë° ì´ë©”ì¼ ë°œì†¡
        def run_analysis_and_send_email():
            try:
                # í˜„ì¬ ì£¼ì‹ ë°ì´í„° (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
                stocks = {
                    'MSFT': {'price': 477.41, 'change': -0.97},
                    'NVDA': {'price': 143.77, 'change': -1.15},
                    'AAPL': {'price': 199.69, 'change': 0.74},
                    'AMZN': {'price': 208.99, 'change': -2.09},
                    'META': {'price': 682.23, 'change': -2.64},
                    'GOOGL': {'price': 168.16, 'change': -3.33},
                    'TSLA': {'price': 322.17, 'change': -1.72},
                    'PLTR': {'price': 137.51, 'change': -2.27}
                }
                
                # ê°„ë‹¨í•œ ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±
                report = f'''
ğŸ“Š ì¼ì¼ ì£¼ì‹ ë¶„ì„ ë¦¬í¬íŠ¸ - {datetime.now().strftime('%Yë…„ %mì›” %dì¼')}

ğŸ¯ ì£¼ìš” ì£¼ì‹ í˜„í™©:
'''
                
                for symbol, data in stocks.items():
                    direction = 'ğŸ“ˆ' if data['change'] > 0 else 'ğŸ“‰'
                    report += f'{direction} {symbol}: ${data[\"price\"]:.2f} ({data[\"change\"]:+.2f}%)\n'
                
                report += '''

ğŸ’¡ íˆ¬ì ì¶”ì²œ:
â€¢ BUY: NVDA, PLTR (AI ì„¹í„° ì„±ì¥ ì „ë§)
â€¢ HOLD: MSFT, AAPL, AMZN (ì•ˆì •ì  ì„±ì¥)
â€¢ WATCH: META, GOOGL, TSLA (ë‹¨ê¸° ë³€ë™ì„± ì£¼ì˜)

ğŸ“Š ì‹œì¥ ì „ë§:
â€¢ ë‹¨ê¸°: ì¤‘ë¦½ì  (Fed ì •ì±… ëŒ€ê¸°)
â€¢ ì¥ê¸°: ê¸ì •ì  (AI ê¸°ìˆ  ë°œì „)

âš ï¸ ì£¼ìš” ë¦¬ìŠ¤í¬:
â€¢ ì§€ì •í•™ì  ê¸´ì¥
â€¢ ì¸í”Œë ˆì´ì…˜ ì¬ìƒìŠ¹ ê°€ëŠ¥ì„±
â€¢ ê¸°ìˆ ì£¼ ë°¸ë¥˜ì—ì´ì…˜ ë¶€ë‹´

ìë™ ìƒì„±ëœ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.
                '''
                
                # ì´ë©”ì¼ ë°œì†¡
                msg = MimeMultipart()
                msg['From'] = os.environ['GMAIL_USERNAME']
                msg['To'] = os.environ['RECIPIENT_EMAIL'] 
                msg['Subject'] = f'ğŸ“Š ì¼ì¼ ì£¼ì‹ ë¶„ì„ ë¦¬í¬íŠ¸ - {datetime.now().strftime(\"%Y-%m-%d\")}'
                
                html_content = f'''
                <html>
                <body style=\"font-family: Arial, sans-serif;\">
                <h2 style=\"color: #2E86AB;\">ğŸ“Š ì¼ì¼ ì£¼ì‹ ë¶„ì„ ë¦¬í¬íŠ¸</h2>
                <h3>ğŸ“… {datetime.now().strftime(\"%Yë…„ %mì›” %dì¼ (%A)\")}</h3>
                <pre style=\"background-color: #f8f9fa; padding: 20px; border-radius: 8px; font-size: 14px; line-height: 1.6;\">
{report}
                </pre>
                <hr style=\"margin: 30px 0;\">
                <p style=\"color: #6c757d; font-size: 12px;\">
                <em>ğŸ¤– ì´ ë¦¬í¬íŠ¸ëŠ” GitHub Actionsë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</em><br>
                <em>ğŸ“§ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ íšŒì‹ í•´ì£¼ì„¸ìš”.</em>
                </p>
                </body>
                </html>
                '''
                
                msg.attach(MimeText(html_content, 'html', 'utf-8'))
                
                # Gmail SMTPë¡œ ì „ì†¡
                server = smtplib.SMTP('smtp.gmail.com', 587)
                server.starttls()
                server.login(os.environ['GMAIL_USERNAME'], os.environ['GMAIL_PASSWORD'])
                server.send_message(msg)
                server.quit()
                
                print('âœ… ì´ë©”ì¼ ì „ì†¡ ì™„ë£Œ!')
                
            except Exception as e:
                print(f'âŒ ì˜¤ë¥˜ ë°œìƒ: {e}')
                raise
        
        run_analysis_and_send_email()
        "
